<!DOCTYPE html>
<html>
<head>
<title>Elysian HTTP Server</title>
<link rel="stylesheet" type="text/css" href="../../fs_root/rom/css.css">

	<script>
		var mem_data = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
		function graph_func(data_y) {
			var c = document.getElementById("myCanvas");
			var ctx = c.getContext("2d");

			// Make it visually fill the positioned parent
			c.style.width ='100%';
			c.style.height='100%';
			// ...then set the internal size to match
			c.width  = c.offsetWidth;
			c.height = c.offsetHeight;
  
			var max_y = 10000;
			//var data_y = [0,50,20,90,100,50,70,10,30,50,88,34,24,34,45,12,13,15,67,78,45,34,12,12,43,34,45,56,34,34,45,34,12,34,45,12,19,56,67,89];
			var dx = (c.width / (data_y.length - 1));

			ctx.setLineDash([5,2]);
			
			ctx .beginPath();
			ctx .lineWidth = "1";
			ctx .moveTo(dx * 0, c.height - (c.height * data_y[0]/ max_y));
			
			for (i = 1; i < data_y.length; i++) { 
				ctx .lineTo(dx * i, c.height - (c.height * data_y[i]/ max_y));
			}
			
			ctx .stroke();
			
			ctx.font="20px"
			ctx.fillText("100%",0, c.height - (c.height * 100/ max_y) + 20);
			ctx.fillText("0%",0, c.height - (c.height * 0 / max_y));
		};
		
		var interval = 500; // msec
		setInterval(ajax_send_http_request, interval);

		function ajax_send_http_request() {
		  var xhttp;
		 // if (window.XMLHttpRequest) {
			// code for modern browsers
		 //   xhttp = new XMLHttpRequest();
		  //  } else {
			// code for IE6, IE5
		  //  xhttp = new ActiveXObject("Microsoft.XMLHTTP");
		 // }
		  xhttp = new(this.XMLHttpRequest || ActiveXObject)('MSXML2.XMLHTTP.3.0');
		
		  xhttp.onreadystatechange = function() {
			//alert('status ' + this.status)
			if (this.readyState > 3) {
				var response = this.responseText;
				
			  document.getElementById("ajax_result").innerHTML = "Instant RAM usage is <b>" + response + "</b> bytes." //this.responseText;
			  
				for (i = mem_data.length - 1; i > 0; i--) { 
					mem_data[i] = mem_data[i-1];
				}
			  //var data = [parseInt(this.responseText),500,200,900,1000];
			  mem_data[0] = parseInt(response);
			  graph_func(mem_data);
			}
		  };
		  xhttp.open("GET", "http://localhost:9000/../../fs_root/rom/ajax_controller", true);
		  xhttp.send();
		}
	</script>
	
</head>
<body onload="ajax_send_http_request()">

<div id="page_el_header">
	<h1>Elysian Web Server</h1>
	<h3>/Expectations revised</h3>
</div>

<div id="page_el_menu">
	<div class="page_el_menu_item"><a href="../../fs_root/rom/index.html">Home</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/static_page.html">Static Web Page</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/dynamic_page.html">Dynamic Web Page</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/form_get.html">HTTP GET Form</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/form_post.html">HTTP POST Form</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/file_upload.html">File Upload Form</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/basic_access_auth.html">Basic Access Auth (admin, admin)</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/redirected_page0.html">HTTP Redirection</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/ajax.html">Ajax</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/gallery.html">Gallery</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/file_download.html">File Download</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/rom/partial_content.html">Streaming Audio (HTTP Partial Content)</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/disk/elysian_fs_root/dynamic_page_disk.html">Dynamic Web Page (Disk)</a></div>
	<div class="page_el_menu_item"><a href="../../fs_root/disk/elysian_fs_root/file_upload_disk.html">File Upload Form (Disk)</a></div>
	<div class="page_el_cleaner"></div>
</div>

<div id="page_el_description">
	<div id="page_el_description_header">
	AJAX web technology
	</div>
	Below is the RAM usage of Elysian Web Server, updated every 500ms.<br>
	To see it changing, open a seperate Web Browser and browse Elysian.
</div>

<div id="page_el_main">
	<div id="page_el_main_results">
		<div id="ajax_result"></div>
	</div>
	
	<div id="page_el_main_graph">
		<canvas id="myCanvas" width="600" height="100"></canvas>
	</div>
</div>


<script>






</script>



<div id="page_el_footer">
&copy;2016 Elysian Web Server | All right reserved
</div>

</body>
</html>